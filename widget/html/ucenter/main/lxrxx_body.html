<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>周转宝</title>
    <link href="../../../css/css/Hui.css" rel="stylesheet" type="text/css" />
    <style type="text/css"></style>
</head>
<body>
    <div class="H-flexbox-horizontal H-border-vertical-bottom-after">
        <input type="text" id="name" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="父亲姓名" /><span tapmode="" onclick="H.openContacts(function (ret, err) { if (ret.status) { H.D('#name').value = ret.name; H.D('#phone').value = ret.phone.replace('-',''); } });" class="H-icon H-vertical-middle H-padding-horizontal-right-10 H-theme-background-color-white"><i class="H-iconfont H-icon-contacts H-font-size-26 H-vertical-middle H-theme-font-color6"></i></span>
    </div>
    <div tapmode="" onclick="H.selectTip(H.D('#xl'), ['父子'])" class="H-flexbox-horizontal H-border-vertical-bottom-after">
        <input type="text" id="xl" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" value="父子" placeholder="请选择亲属关系" readonly="readonly" /><span class="H-icon H-vertical-middle H-padding-horizontal-right-10 H-theme-background-color-white"><i class="H-iconfont H-icon-arrow-down H-font-size-16 H-vertical-middle H-theme-font-color-999"></i></span>
    </div>
    <div class="H-flexbox-horizontal H-border-vertical-bottom-after">
        <input type="text" id="phone" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="父亲电话" />
    </div>

    <div class="H-flexbox-horizontal H-border-vertical-bottom-after H-margin-vertical-top-10">
        <input type="text" id="name2" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="母亲姓名" /><span tapmode="" onclick="H.openContacts(function (ret, err) { if (ret.status) { H.D('#name2').value = ret.name; H.D('#phone2').value = ret.phone.replace('-',''); } });" class="H-icon H-vertical-middle H-padding-horizontal-right-10 H-theme-background-color-white"><i class="H-iconfont H-icon-contacts H-font-size-26 H-vertical-middle H-theme-font-color6"></i></span>
    </div>
    <div tapmode="" onclick="H.selectTip(H.D('#hy'), ['母子'])" class="H-flexbox-horizontal H-border-vertical-bottom-after">
        <input type="text" id="hy" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" value="母子" placeholder="请选择亲属关系" readonly="readonly" /><span class="H-icon H-vertical-middle H-padding-horizontal-right-10 H-theme-background-color-white"><i class="H-iconfont H-icon-arrow-down H-font-size-16 H-vertical-middle H-theme-font-color-999"></i></span>
    </div>
    <div class="H-flexbox-horizontal H-border-vertical-bottom-after">
        <input type="text" id="phone2" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="母亲电话" />
    </div>

    <div class="H-flexbox-horizontal H-border-vertical-bottom-after H-margin-vertical-top-10">
        <input type="text" id="name3" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="同学姓名" /><span tapmode="" onclick="H.openContacts(function (ret, err) { if (ret.status) { H.D('#name3').value = ret.name; H.D('#phone3').value = ret.phone.replace('-',''); } });" class="H-icon H-vertical-middle H-padding-horizontal-right-10 H-theme-background-color-white"><i class="H-iconfont H-icon-contacts H-font-size-26 H-vertical-middle H-theme-font-color6"></i></span>
    </div>
    <div tapmode="" onclick="H.selectTip(H.D('#hq'), ['同学'])" class="H-flexbox-horizontal H-border-vertical-bottom-after">
        <input type="text" id="hy" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" value="同学" placeholder="请选择亲属关系" readonly="readonly" /><span class="H-icon H-vertical-middle H-padding-horizontal-right-10 H-theme-background-color-white"><i class="H-iconfont H-icon-arrow-down H-font-size-16 H-vertical-middle H-theme-font-color-999"></i></span>
    </div>
    <div class="H-flexbox-horizontal H-border-vertical-bottom-after">
        <input type="text" id="phone3" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="同学电话" />
    </div>

    <div class="H-flexbox-horizontal H-border-vertical-bottom-after H-margin-vertical-top-10">
        <input type="text" id="name4" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="辅导员姓名" /><span tapmode="" onclick="H.openContacts(function (ret, err) { if (ret.status) { H.D('#name4').value = ret.name; H.D('#phone4').value = ret.phone.replace('-',''); } });" class="H-icon H-vertical-middle H-padding-horizontal-right-10 H-theme-background-color-white"><i class="H-iconfont H-icon-contacts H-font-size-26 H-vertical-middle H-theme-font-color6"></i></span>
    </div>
    <div tapmode="" onclick="H.selectTip(H.D('#hw'), ['辅导员'])" class="H-flexbox-horizontal H-border-vertical-bottom-after">
        <input type="text" id="hy" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" value="辅导员" placeholder="请选择亲属关系" readonly="readonly" /><span class="H-icon H-vertical-middle H-padding-horizontal-right-10 H-theme-background-color-white"><i class="H-iconfont H-icon-arrow-down H-font-size-16 H-vertical-middle H-theme-font-color-999"></i></span>
    </div>
    <div class="H-flexbox-horizontal H-border-vertical-bottom-after">
        <input type="text" id="phone4" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="辅导员电话" />
    </div>

    <div class="H-padding-10">
        <button class="H-button H-width-100-percent  H-font-size-15 H-outline-none H-padding-vertical-both-12 H-padding-horizontal-both-20 H-theme-background-color6 H-theme-font-color-white H-theme-border-color6 H-theme-border-color6-click H-theme-background-color6-click H-theme-font-color6-click H-border-radius-3" tapmode="active" onclick="mcm_insert(this)">提交保存</button>
    </div>
    <script src="../../../script/h/H.js" type="text/javascript"></script>
    <script type="text/javascript" src="../../../script/mcm/common.js"></script>
    <script type="text/javascript" src="../../../script/mcm/SHA1.js"></script>
    <script type="text/javascript" src="../../../script/mcm/api.js"></script>
    <script type="text/javascript">
        var mcm = null;
        var query = null;
        apiready = function(){

            mcm = api.require('model');
            query = api.require('query');
            //在线编译正式版时，可以不用配置,APICloud会取当前应用的配置
            mcm.config({
                appId:"A6915918961135", 
                appKey:"02E0067E-57AF-1EBB-12AF-05666A9278D4", 
                url:'https://d.apicloud.com'
            });
            var us = $api.getStorage('user');

            var query = api.require("query");

            query.createQuery(function(ret, err) {
                if (ret && ret.qid) {
                    var queryId = ret.qid;

                    query.whereEqual({
                        qid: queryId,
                        column: "username",
                        value: us
                    });

                    query.limit({
                        qid:queryId,
                        value:"1000000"
                    });

                    var model = api.require("model");

                    model.findAll({
                        class: "Endo",
                        qid: queryId
                    }, function(ret, err){
                        JSON.stringify(ret)
                        // alert(ret[0].id);
                        var lid = ret[0].id ;
                        // alert(uid);
                        $api.setStorage('lid',lid);
                        // alert(ret.id);

                    });
                }
            });

        }
        var us = $api.getStorage('user');
        
        var clazz = "lxr";

        function mcm_insert(tag){
                if (! $api.hasCls(tag, 'disabled')) {
                var name = $api.dom('#name');
                var phone = $api.dom('#phone');
                var name2 = $api.dom('#name2');
                var phone2 = $api.dom('#phone2');
                var name3 = $api.dom('#name3');
                var phone3 = $api.dom('#phone3');
                var name4 = $api.dom('#name4');
                var phone4 = $api.dom('#phone4');
                if (!$api.val(name)) {
                    $api.toast('不能为空！');
                } else if (!$api.val(phone)) {
                    $api.toast('不能为空！');
                } else if (!$api.val(name2)) {
                    $api.toast('不能为空！');
                } else if (!$api.val(phone2)) {
                    $api.toast('不能为空！');
                }  else if (!$api.val(name3)) {
                    $api.toast('不能为空！');
                } else if (!$api.val(phone3)) {
                    $api.toast('不能为空！');
                } else if (!$api.val(name4)) {
                    $api.toast('不能为空！');
                } else if (!$api.val(phone4)) {
                    $api.toast('不能为空！');
                } else {
                    // var us = $api.getStorage('user');
                    var ac = value('name');
                    var bc = '父亲';
                    var ax = value('phone');
                    var cx = value('name2');
                    var dx = '母亲';
                    var wx = value('phone2');
                    var qq = value('name3');
                    var ww = '同学';
                    var ee = value('phone3');
                    var rr = value('name4');
                    var tt = '辅导员';
                    var yy = value('phone4');                                        
                    var dc = {
                        qinshu1:ac, 
                        phone1:ax, 
                        qinshu2:cx, 
                        phone2:wx, 
                        username:us,
                        tphone:ee, 
                        tname:qq, 
                        fphone:yy, 
                        fname:rr,
                        guanxi1:bc,
                        guanxi2:dx,
                        tguanxi:ww,
                        fguanxi:tt
                    };
                    var param = {class:clazz, value:dc};
                    loading();
                    mcm.insert(param, function(ret, err){
                        finishing();
                        if(ret){
                            showAlert("提交成功");
                            jindua();
                            add();
                            api.closeWin();
                        }else{
                            showAlert("提交失败，请检查网络设置！");
                        }
                    });
                }
            }
        }
        
        function add(){
            var lid = $api.getStorage('lid');
            var name = $api.dom('#name');
            var phone = $api.dom('#phone');
            var name2 = $api.dom('#name2');
            var phone2 = $api.dom('#phone2');
            var name3 = $api.dom('#name3');
            var phone3 = $api.dom('#phone3');
            var name4 = $api.dom('#name4');
            var phone4 = $api.dom('#phone4');
            var fc = value('name');
            var fx = value('phone');
            var mx = value('name2');
            var mc = value('phone2');
            var tq = value('name3');
            var te = value('phone3');
            var fr = value('name4');
            var fy = value('phone4'); 
            var model = api.require("model");

            model.updateById({
                class: "Endo",
                id: lid,
                value: {
                    'fqxm': fc,
                    'fqsj':fx,
                    'mqxm': mx,
                    'mqsj':mc,
                    'txxm': tq,
                    'txsj':te,
                    'fdyxm': fr,
                    'fdysj':fy
                }
            }, function(ret, err){
                // alert("ret: " + JSON.stringify(ret) + "\nerr: " + JSON.stringify(err));
            });
        } 

        function jindua(){
            var jin = "jindu";
          // var us = $api.getStorage('user');
          var bc = '已提交联系人信息';
          var cx = {username:us, jindu:bc}
          var param = {class:jin, value:cx};
          loading();
          mcm.insert(param, function(ret, err){
              finishing();
              if(ret){
                 // showAlert("提交成功,请完善资料");
              }else{
                //  showAlert("提交失败，请检查网络设置！");
              }
          });           
        }
    </script>
</body>
</html>