<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>周转宝</title>
    <link href="../../../css/css/Hui.css" rel="stylesheet" type="text/css" />
    <style type="text/css"></style>
</head>
<body>
    <div class="H-flexbox-horizontal H-border-vertical-bottom-after">
        <input type="text" id="tjr-name" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="直系亲属姓名" /><span tapmode="" onclick="H.openContacts(function (ret, err) { if (ret.status) { H.D('#tjr-name').value = ret.name; H.D('#tjr-phone').value = ret.phone.replace('-',''); } });" class="H-icon H-vertical-middle H-padding-horizontal-right-10 H-theme-background-color-white"><i class="H-iconfont H-icon-contacts H-font-size-26 H-vertical-middle H-theme-font-color6"></i></span>
    </div>
    <div tapmode="" onclick="H.selectTip(H.D('#xl'), ['父子', '母子'])" class="H-flexbox-horizontal H-border-vertical-bottom-after">
        <input type="text" id="xl" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="请选择亲属关系" readonly="readonly" /><span class="H-icon H-vertical-middle H-padding-horizontal-right-10 H-theme-background-color-white"><i class="H-iconfont H-icon-arrow-down H-font-size-16 H-vertical-middle H-theme-font-color-999"></i></span>
    </div>
    <div class="H-flexbox-horizontal H-border-vertical-bottom-after">
        <input type="text" id="tjr-phone" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="联系电话" />
    </div>
    <div class="H-flexbox-horizontal H-border-vertical-bottom-after H-margin-vertical-top-10">
        <input type="text" id="tjr-name2" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="备用联系人" /><span tapmode="" onclick="H.openContacts(function (ret, err) { if (ret.status) { H.D('#tjr-name2').value = ret.name; H.D('#tjr-phone2').value = ret.phone.replace('-',''); } });" class="H-icon H-vertical-middle H-padding-horizontal-right-10 H-theme-background-color-white"><i class="H-iconfont H-icon-contacts H-font-size-26 H-vertical-middle H-theme-font-color6"></i></span>
    </div>
    <div tapmode="" onclick="H.selectTip(H.D('#hy'), ['父子', '母子'])" class="H-flexbox-horizontal H-border-vertical-bottom-after">
        <input type="text" id="hy" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="请选择亲属关系" readonly="readonly" /><span class="H-icon H-vertical-middle H-padding-horizontal-right-10 H-theme-background-color-white"><i class="H-iconfont H-icon-arrow-down H-font-size-16 H-vertical-middle H-theme-font-color-999"></i></span>
    </div>
    <div class="H-flexbox-horizontal H-border-vertical-bottom-after">
        <input type="text" id="tjr-phone2" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-16 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-12" placeholder="联系电话" />
    </div>
    <div class="H-padding-10">
        <button class="H-button H-width-100-percent  H-font-size-15 H-outline-none H-padding-vertical-both-12 H-padding-horizontal-both-20 H-theme-background-color6 H-theme-font-color-white H-theme-border-color6 H-theme-border-color6-click H-theme-background-color6-click H-theme-font-color6-click H-border-radius-3" tapmode="active" onclick="mcm_insert(this)">提交保存</button>
    </div>
    <script src="../../../script/h/H.js" type="text/javascript"></script>
    <script type="text/javascript" src="../../../script/mcm/common.js"></script>
    <script type="text/javascript" src="../../../script/mcm/SHA1.js"></script>
    <script type="text/javascript" src="../../../script/mcm/api.js"></script>
    <script type="text/javascript">
        var mcm = null;
        var query = null;
        apiready = function(){
            var key = $api.getStorage('key');
                $api.ajax('/user/'+key, 'get', null, function (ret, err) {
                    if (ret) {
                        $api.setStorage('user', ret.username );
                    } else {
                        $api.toast( err.msg );
                    }
                });
            mcm = api.require('model');
            query = api.require('query');
            //在线编译正式版时，可以不用配置,APICloud会取当前应用的配置
            mcm.config({
                appId:"A6915918961135", 
                appKey:"02E0067E-57AF-1EBB-12AF-05666A9278D4", 
                url:'https://d.apicloud.com'
            });
        }
        
        var clazz = "lxr";

        function mcm_insert(tag){
                if (! $api.hasCls(tag, 'disabled')) {
                var tjrname = $api.dom('#tjr-name');
                var tjrphone = $api.dom('#tjr-phone');
                var tjrname2 = $api.dom('#tjr-name2');
                var tjrphone2 = $api.dom('#tjr-phone2');
                if (!$api.val(tjrname)) {
                    $api.toast('不能为空！');
                } else if (!$api.val(tjrphone)) {
                    $api.toast('不能为空！');
                } else if (!$api.val(tjrname2)) {
                    $api.toast('不能为空！');
                } else if (!$api.val(tjrphone2)) {
                    $api.toast('不能为空！');
                } else {
                    var us = $api.getStorage('user');
                    var ac = value('tjr-name');
                    var bc = value('xl');
                    var ax = value('tjr-phone');
                    var cx = value('tjr-name2');
                    var dx = value('hy');
                    var wx = value('tjr-phone2');
                    var dc = {qinshu1:ac, guanxi1:bc, phone1:ax, qinshu2:cx, guanxi2:dx, phone2:wx, username:us};
                    var param = {class:clazz, value:dc};
                    loading();
                    mcm.insert(param, function(ret, err){
                        finishing();
                        if(ret){
                            showAlert("提交成功");
                            jindua();
                            api.closeWin();
                        }else{
                            showAlert("提交失败，请检查网络设置！");
                        }
                    });
                }
            }
        }
        
        function jindua(){
            var jin = "jindu";
          var us = $api.getStorage('user');
          var bc = '已提交联系人信息';
          var cx = {username:us, jindu:bc}
          var param = {class:jin, value:cx};
          loading();
          mcm.insert(param, function(ret, err){
              finishing();
              if(ret){
                 // showAlert("提交成功,请完善资料");
              }else{
                //  showAlert("提交失败，请检查网络设置！");
              }
          });           
        }
    </script>
</body>
</html>